<head>
    <script src="jquery-3.6.4.min.js"></script>
    <style>
      canvas {border: 1px solid black;}
      #plot{
        position: absolute; left: 0px; top: 0px;
      }
      #points{
        position: absolute; left: 50px; top: 0px;
        line-height: 1;
        width:150px;
        height:500px;
      }
      #myCanvas{
        position: absolute; left: 210px; top: 0px;
        width:500px;height:500px;
      }
      #opttown{
        position: absolute; left: 710px; top: 0px;
        width:200px;height:500px;
      }
      div.floatnone {
        float: left;
        vertical-align:top;
      }
    </style>

<script>
  var canvas = document.getElementById("myCanvas");
  var ctx = canvas.getContext("2d");
  var fontSize = 12; // フォントサイズ
  var fontFamily = "bold Arial"; // フォントファミリー
  var textColor = "red"; // テキストカラー
  var xoffset,yoffset;
  var rasio=1.0;

  var mySavedData = sessionStorage.getItem('key');
  $("#points").val(mySavedData);
  ctx.fillText("n", canvas.width -20,canvas.height-20);
  ctx.font = "bold 10px Arial";
  
  $("#opttown").on("dblclick", "option",function(){
    $("#points").val( $(this).val() + "\n" + $("#points").val());
  });
  $("#opttown").on("enter", "option",function(){
    $("#points").val( $(this).val() + "\n" + $("#points").val());
  });
  
  $("#plot").on('click', event => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    var arr = $("#points").val().split("\n");
    //var xmax=0, xmin=99999, ymax=0, ymin=99999;
    var xmax=0, xmin=99999, ymax=0, ymin=99999;
    var plotarray = [];
    $.each(arr,function(i,v){
      ctx.fillStyle = "black";
      var point = v.split(",")
      var plotdata = [];
      if((point.length==2 && $.isNumeric(point[0]) && $.isNumeric(point[1])) ){  
        plotdata = [v.trim(),""+(i+1),parseFloat(point[0]),parseFloat(point[1]),(i+1)];
      }
      else if((point.length==3 && $.isNumeric(point[1]) && $.isNumeric(point[2])) ){  
        plotdata = [v.trim(),point[0],parseFloat(point[1]),parseFloat(point[2]),(i+1)];
      }
      else {
        plotdata = [v.trim()];
        plotarray.push(plotdata) 
        return true;
      }
      xmax = Math.max(xmax, plotdata[2]);
      xmin = Math.min(xmin, plotdata[2]);       
      ymax = Math.max(ymax, plotdata[3]);
      ymin = Math.min(ymin, plotdata[3]); 
      plotarray.push(plotdata) 
      console.log(`${xmax} ${xmin}`)
    });
    if(xmax>15000 &&xmin<1000 ){
      xmax=0;
      xmin=99999;
      $.each(plotarray,function(i,v){
        if(v.length==1){
          return true;
        }
        if(v[2]<6000){
          plotarray[i]=[v[0],v[1],v[2]+16384,v[3],v[4]]
        }
        else{          
         // plotarray[i]=[v[0],v[1]-14000,v[2]]
        }
        xmax = Math.max(xmax, plotarray[i][2]);
        xmin = Math.min(xmin, plotarray[i][2]);  
        console.log(`${xmax} ${xmin} ${v[4]} ${v.length}`)
      });
    }
    else if( xmin>16384 ){
      xmax=0;
      xmin=99999;
      $.each(plotarray,function(i,v){
        if(v.length==1){
          return true;
        }
        plotarray[i]=[v[0],v[1],v[2]-16384,v[3],v[4]]
        xmax = Math.max(xmax, plotarray[i][2]);
        xmin = Math.min(xmin, plotarray[i][2]);  
        console.log(`${xmax} ${xmin} ${v[4]} ${v.length}`)
      });

    }
    xoffset = xmax-xmin;
    yoffset = ymax-ymin;
    base = 475;
    console.log(`${xmax} ${xmin}`)
    rasio = Math.min( base/xoffset , base/yoffset );
    var data="";
    $.each(plotarray,function(i,v){
      if(v.length<=2){
        switch(v[0]){
          case "aqua":
          case "black":
          case "blue":
          case "fuchsia":
          case "gray":
          case "green":
          case "lime":
          case "maroon":
          case "navy":
          case "olive":
          case "orange":
          case "purple":
          case "red":
          case "silver":
          case "teal":
          case "white":
          case "yellow":
            ctx.fillStyle = v[0];
            break
        }
        data += v[0]+ "\n";
        return true;
      }
      try{
        //console.log(`${v[1]} ${v[2]} ${v[3]} `+ rasio);
        plot(v[1].replace("{n}",v[4]), (v[2]-xmin)*rasio +10, (v[3]-ymin)*rasio +10);
        data += v[1].replace("{n}",v[4]) + "," + v[2] + "," + v[3] + "\n";
      }
      catch{
        console.log("err:"+v);
      }        
    });
    $("#points").val(data) 
    sessionStorage.setItem('key' , $("#points").val() );
  });
  function plot(n,x,y){
    //console.log(`${n} ${x} ${y}`);
    ctx.fillText(""+n+"", x, y);
  }
    </script>
</head>
<button id="plot" >表示</button>
<textarea id="points" ></textarea>
<canvas id="myCanvas" width="500" height="500"></canvas>
<select id="opttown" size="50">
  <option value="サ,10568,3100" class="北米西岸">サンフランシスコ</option>
  <option value="タ,10521,2603" class="北米西岸">タコマ</option>
  <option value="シ,10351,2258" class="北米西岸">シトカ</option>
  <option value="バ,9307,1063" class="アラスカ">バロー</option>
  <option value="チ,12337,1966" class="カナダ">チャーチル</option>
  <option value="グ,12140,3640" class="北米東岸">グレートプレーンズ</option>
  <option value="ボ,13239,3058" class="北米東岸">ボストン</option>
  <option value="長,6060,3467" class="東アジア">長崎</option>
  <option value="澳,5185,3903" class="東アジア">澳門</option>
  <option value="泉,5405,3809" class="東アジア">泉州</option>
  <option value="安,5672,3914" class="東アジア">安平</option>
  <option value="淡,5707,3776" class="東アジア">淡水</option>
  <option value="杭,5547,3552" class="東アジア">杭州</option>
  <option value="重,4764,3533" class="東アジア">重慶</option>
  <option value="雲,5475,3359" class="東アジア">雲台山</option>
  <option value="漢,5771,3225" class="東アジア">漢陽</option>
  <option value="釜,5916,3345" class="東アジア">釜山</option>
  <option value="浦,5923,3277" class="東アジア">浦項</option>
  <option value="堺,6329,3403" class="東アジア">堺</option>
  <option value="江,6559,3339" class="東アジア">江戸</option>
  <option value="ザ,5242,3288" class="東アジア">ザナドゥ</option>
  <option value="ナ,16097,2737" class="ヨーロッパ北部">ナント</option>
  <option value="カ,16305,2568" class="ヨーロッパ北部">カレー</option>
  <option value="ア,47,2521" class="ヨーロッパ北部">アントワープ</option>
  <option value="ロ,16324,2418" class="ヨーロッパ北部">ロンドン</option>
  <option value="ド,16324,2490" class="ヨーロッパ北部">ドーバー</option>
  <option value="プ,16085,2494" class="ヨーロッパ北部">プリマス</option>
  <option value="ボ,16109,2838" class="ヨーロッパ北部">ボルドー</option>
  <option value="ス,846,1979" class="ヨーロッパ北部">ストックホルム</option>
  <option value="ヘ,66,2466" class="ヨーロッパ北部">ヘルデル</option>
  <option value="オ,485,1949" class="ヨーロッパ北部">オスロ</option>
  <option value="ア,97,2497" class="ヨーロッパ北部">アムステルダム</option>
  <option value="ハ,357,2364" class="ヨーロッパ北部">ハンブルク</option>
  <option value="エ,16205,2122" class="ヨーロッパ北部">エディンバラ</option>
  <option value="コ,530,2210" class="ヨーロッパ北部">コペンハーゲン</option>
  <option value="ダ,16050,2278" class="ヨーロッパ北部">ダブリン</option>
  <option value="リ,484,2333" class="ヨーロッパ北部">リューベック</option>
  <option value="リ,1071,2145" class="ヨーロッパ北部">リガ</option>
  <option value="ベ,237,1955" class="ヨーロッパ北部">ベルゲン</option>
  <option value="フ,143,2452" class="ヨーロッパ北部">フローニンゲン</option>
  <option value="ダ,863,2312" class="ヨーロッパ北部">ダンツィヒ</option>
  <option value="ブ,226,2393" class="ヨーロッパ北部">ブレーメン</option>
  <option value="ヴ,840,2104" class="ヨーロッパ北部">ヴィスビー</option>
  <option value="フ,357,2364" class="ヨーロッパ北部">フランクフルト</option>
  <option value="コ,979,1760" class="ヨーロッパ北部">コッコラ</option>
  <option value="サ,1211,1956" class="ヨーロッパ北部">サンクトペテルブルク</option>
  <option value="マ,16164,2271" class="ヨーロッパ北部">マンチェスター</option>
  <option value="ル,16258,2576" class="ヨーロッパ北部">ルアーブル</option>
  <option value="ロ,52,2492" class="ヨーロッパ北部">ロッテルダム</option>
  <option value="ポ,16256,2488" class="ヨーロッパ北部">ポーツマス</option>
  <option value="ヨ,485,2000" class="ヨーロッパ北部">ヨーテボリ</option>
  <option value="オ,15765,3119" class="ヨーロッパ西部">オポルト</option>
  <option value="リ,15782,3205" class="ヨーロッパ西部">リスボン</option>
  <option value="フ,15802,3266" class="ヨーロッパ西部">ファロ</option>
  <option value="セ,15902,3270" class="ヨーロッパ西部">セビリア</option>
  <option value="マ,16058,3274" class="ヨーロッパ西部">マラガ</option>
  <option value="バ,16179,3159" class="ヨーロッパ西部">バレンシア</option>
  <option value="パ,16286,3206" class="ヨーロッパ西部">パルマ</option>
  <option value="バ,16357,3110" class="ヨーロッパ西部">バルセロナ</option>
  <option value="モ,42,3004" class="ヨーロッパ西部">モンペリエ</option>
  <option value="マ,126,2969" class="ヨーロッパ西部">マルセイユ</option>
  <option value="ジ,300,2918" class="ヨーロッパ西部">ジェノヴァ</option>
  <option value="カ,293,2974" class="ヨーロッパ西部">カルヴィ</option>
  <option value="サ,269,3093" class="ヨーロッパ西部">サッサリ</option>
  <option value="カ,329,3170" class="ヨーロッパ西部">カリアリ</option>
  <option value="ピ,361,2952" class="ヨーロッパ西部">ピサ</option>
  <option value="セ,15970,3360" class="ヨーロッパ西部">セウタ</option>
  <option value="カ,15773,3445" class="ヨーロッパ西部">カサブランカ</option>
  <option value="マ,15486,3439" class="ヨーロッパ西部">マディラ</option>
  <option value="ラ,15510,3673" class="ヨーロッパ西部">ラスパルマス</option>
  <option value="ヒ,15847,2921" class="ヨーロッパ西部">ヒホン</option>
  <option value="チ,420,3268" class="ヨーロッパ西部">チュニス</option>
  <option value="ア,35,3275" class="ヨーロッパ西部">アルジェ</option>
  <option value="ト,490,3426" class="ヨーロッパ西部">トリポリ</option>
  <option value="ア,14732,3148" class="ヨーロッパ西部">アゾレス</option>
  <option value="ビ,16051,2942" class="ヨーロッパ西部">ビルバオ</option>
  <option value="ヴ,15770,3052" class="ヨーロッパ西部">ヴィアナドカステロ</option>
  <option value="サ,15781,3244" class="ヨーロッパ西部">サグレス</option>
  <option value="ア,1088,3258" class="ヨーロッパ東部">アテネ</option>
  <option value="ラ,799,2978" class="ヨーロッパ東部">ラグーザ</option>
  <option value="ヴ,542,2806" class="ヨーロッパ東部">ヴェネツィア</option>
  <option value="ナ,616,3118" class="ヨーロッパ東部">ナポリ</option>
  <option value="シ,617,3240" class="ヨーロッパ東部">シラクサ</option>
  <option value="ア,1344,3534" class="ヨーロッパ東部">アレクサンドリア</option>
  <option value="ヤ,1553,3503" class="ヨーロッパ東部">ヤッファ</option>
  <option value="ベ,1598,3397" class="ヨーロッパ東部">ベイルート</option>
  <option value="フ,1538,3381" class="ヨーロッパ東部">ファマガスタ</option>
  <option value="カ,1417,3600" class="ヨーロッパ東部">カイロ</option>
  <option value="ト,650,2822" class="ヨーロッパ東部">トリエステ</option>
  <option value="ア,582,2916" class="ヨーロッパ東部">アンコナ</option>
  <option value="ザ,717,2917" class="ヨーロッパ東部">ザダール</option>
  <option value="イ,1294,3042" class="ヨーロッパ東部">イスタンブール</option>
  <option value="カ,1195,3370" class="ヨーロッパ東部">カンディア</option>
  <option value="サ,1038,3115" class="ヨーロッパ東部">サロニカ</option>
  <option value="カ,1651,2845" class="ヨーロッパ東部">カッファ</option>
  <option value="ト,1706,3042" class="ヨーロッパ東部">トレビゾント</option>
  <option value="オ,1388,2819" class="ヨーロッパ東部">オデッサ</option>
  <option value="ベ,891,3480" class="ヨーロッパ東部">ベンガジ</option>
  <option value="セ,1501,2867" class="ヨーロッパ東部">セヴァストポリ</option>
  <option value="カ,852,3030" class="ヨーロッパ東部">カッターロ</option>
  <option value="サ,242,4757" class="アフリカ西部">サントメ</option>
  <option value="ア,15593,3979" class="アフリカ西部">アルギン</option>
  <option value="シ,15745,4444" class="アフリカ西部">シエラレオネ</option>
  <option value="カ,15464,4194" class="アフリカ西部">カーボヴェルデ</option>
  <option value="ア,16193,4570" class="アフリカ西部">アビジャン</option>
  <option value="サ,73,4522" class="アフリカ西部">サンジョルジュ</option>
  <option value="ル,544,5023" class="アフリカ西部">ルアンダ</option>
  <option value="ベ,194,4551" class="アフリカ西部">ベニン</option>
  <option value="ド,416,4641" class="アフリカ西部">ドゥアラ</option>
  <option value="ガ,366,4806" class="アフリカ西部">ガボン</option>
  <option value="ケ,969,6025" class="アフリカ南部">ケープ</option>
  <option value="カ,610,5598" class="アフリカ南部">カリビブ</option>
  <option value="モ,1865,5340" class="アフリカ南部">モザンビーク</option>
  <option value="ソ,1571,5502" class="アフリカ南部">ソファラ</option>
  <option value="タ,2254,5425" class="アフリカ南部">タマタブ</option>
  <option value="ベ,587,5206" class="アフリカ南部">ベンゲラ</option>
  <option value="ナ,1481,5915" class="アフリカ南部">ナタール</option>
  <option value="イ,1609,5604" class="アフリカ南部">イニャンバネ</option>
  <option value="ザ,1813,4978" class="アフリカ東部・インド">ザンジバル</option>
  <option value="モ,2186,4575" class="アフリカ東部・インド">モガディシオ</option>
  <option value="マ,2698,3854" class="アフリカ東部・インド">マスカット</option>
  <option value="ホ,2532,3728" class="アフリカ東部・インド">ホルムズ</option>
  <option value="デ,3208,3962" class="アフリカ東部・インド">ディヴ</option>
  <option value="ア,2068,4274" class="アフリカ東部・インド">アデン</option>
  <option value="カ,3437,4317" class="アフリカ東部・インド">カリカット</option>
  <option value="ゴ,3314,4114" class="アフリカ東部・インド">ゴア</option>
  <option value="バ,2195,3736" class="アフリカ東部・インド">バスラ</option>
  <option value="モ,1846,4841" class="アフリカ東部・インド">モンバサ</option>
  <option value="マ,1803,4161" class="アフリカ東部・インド">マッサワ</option>
  <option value="ス,1584,3682" class="アフリカ東部・インド">スエズ</option>
  <option value="コ,3463,4416" class="アフリカ東部・インド">コチン</option>
  <option value="セ,3636,4500" class="アフリカ東部・インド">セイロン</option>
  <option value="ポ,3662,4293" class="アフリカ東部・インド">ポンディシェリ</option>
  <option value="マ,3705,4180" class="アフリカ東部・インド">マスリパタム</option>
  <option value="カ,4000,3960" class="アフリカ東部・インド">カルカッタ</option>
  <option value="キ,1775,5087" class="アフリカ東部・インド">キルワ</option>
  <option value="ソ,2474,4272" class="アフリカ東部・インド">ソコトラ</option>
  <option value="ジ,1773,3944" class="アフリカ東部・インド">ジェッダ</option>
  <option value="マ,1912,4788" class="アフリカ東部・インド">マリンディ</option>
  <option value="セ,1935,4310" class="アフリカ東部・インド">セイラ</option>
  <option value="ジ,2444,4132" class="アフリカ東部・インド">ジョファール</option>
  <option value="マ,3410,4270" class="アフリカ東部・インド">マンガロール</option>
  <option value="ヴ,3799,4059" class="アフリカ東部・インド">ヴィシャーカパトナム</option>
  <option value="マ,2300,3825" class="アフリカ東部・インド">マナーマ</option>
  <option value="ヤ,1776,3895" class="アフリカ東部・インド">ヤンブー</option>
  <option value="パ,4635,4816" class="東南アジア">パレンバン</option>
  <option value="マ,4681,4699" class="東南アジア">マラッカ</option>
  <option value="パ,4650,4507" class="東南アジア">パタニ</option>
  <option value="ヤ,4895,4412" class="東南アジア">ヤーデイン</option>
  <option value="ル,5963,4943" class="東南アジア">ルン</option>
  <option value="ス,5207,5032" class="東南アジア">スラバヤ</option>
  <option value="バ,5230,4891" class="東南アジア">バンジェルマシン</option>
  <option value="マ,5468,4921" class="東南アジア">マカッサル</option>
  <option value="ジ,4815,4980" class="東南アジア">ジャカルタ</option>
  <option value="ア,4230,4560" class="東南アジア">アチン</option>
  <option value="ペ,4405,4140" class="東南アジア">ペグー</option>
  <option value="ロ,4652,4245" class="東南アジア">ロッブリー</option>
  <option value="ク,5054,4667" class="東南アジア">クチン</option>
  <option value="ダ,5768,4492" class="東南アジア">ダバオ</option>
  <option value="マ,5572,4268" class="東南アジア">マニラ</option>
  <option value="ブ,5238,4540" class="東南アジア">ブルネイ</option>
  <option value="デ,5799,5076" class="東南アジア">ディリ</option>
  <option value="ジ,4567,4744" class="東南アジア">ジャンビ</option>
  <option value="ア,5812,4912" class="東南アジア">アンボイナ</option>
  <option value="テ,5776,4712" class="東南アジア">テルナーテ</option>
  <option value="ホ,5524,4531" class="東南アジア">ホロ</option>
  <option value="グ,6584,4219" class="東南アジア">グアム</option>
  <option value="サ,6868,5163" class="東南アジア">サマライ</option>
  <option value="ジ,13171,4034" class="カリブ・中米">ジャマイカ</option>
  <option value="サ,13484,4038" class="カリブ・中米">サントドミンゴ</option>
  <option value="サ,13603,4037" class="カリブ・中米">サンフアン</option>
  <option value="サ,13193,3973" class="カリブ・中米">サンティアゴ</option>
  <option value="ハ,12973,3848" class="カリブ・中米">ハバナ</option>
  <option value="ポ,12851,4167" class="カリブ・中米">ポルトベロ</option>
  <option value="カ,13918,4650" class="カリブ・中米">カイエンヌ</option>
  <option value="ペ,14817,5066" class="カリブ・中米">ペルナンブコ</option>
  <option value="グ,12988,3979" class="カリブ・中米">グランドケイマン</option>
  <option value="ト,12707,4028" class="カリブ・中米">トルヒーヨ</option>
  <option value="メ,12398,3920" class="カリブ・中米">メリダ</option>
  <option value="ヴ,12101,4036" class="カリブ・中米">ヴェラクルス</option>
  <option value="マ,13143,4391" class="カリブ・中米">マラカイボ</option>
  <option value="ウ,13240,4308" class="カリブ・中米">ウィレムスタッド</option>
  <option value="カ,13343,4412" class="カリブ・中米">カラカス</option>
  <option value="ナ,13104,3732" class="カリブ・中米">ナッソー</option>
  <option value="ア,11838,4267" class="カリブ・中米">アカプルコ</option>
  <option value="グ,12175,4259" class="カリブ・中米">グァテマラ</option>
  <option value="パ,12716,4260" class="カリブ・中米">パナマ</option>
  <option value="ト,12595,4797" class="カリブ・中米">トゥンベス</option>
  <option value="ラ,12687,5045" class="カリブ・中米">ランバイェケ</option>
  <option value="ヒ,10133,5007" class="カリブ・中米">ヒバオア</option>
  <option value="ポ,13182,4071" class="カリブ・中米">ポートロイヤル</option>
  <option value="バ,14647,5336" class="南米">バイーア</option>
  <option value="リ,14456,5711" class="南米">リオデジャネイロ</option>
  <option value="ブ,13723,6109" class="南米">ブエノスアイレス</option>
  <option value="サ,13487,6302" class="南米">サンアントニオ</option>
  <option value="ウ,13267,6847" class="南米">ウシュアイア</option>
  <option value="バ,13015,6052" class="南米">バルパライソ</option>
  <option value="コ,13143,5793" class="南米">コピアポ</option>
  <option value="リ,12835,5259" class="南米">リマ</option>
  <option value="カ,6332,5700" class="オセアニア">カカドゥ</option>
  <option value="ワ,8312,6582" class="オセアニア">ワンガヌイ</option>
  <option value="ホ,7047,6960" class="オセアニア">ホバート</option>
  <option value="ク,7303,6251" class="オセアニア">クガリ</option>
  <option value="ピ,5564,6477" class="オセアニア">ピンジャラ</option>
  <option value="ハ,9095,3963" class="オセアニア">ハワイ</option>
  <option value="ナ,699,1318" class="ヨーロッパ極北部">ナルヴィク</option>
  <option value="マ,3315,1062" class="ユーラシア北部">マンガゼヤ</option>
  <option value="テ,5952,960" class="ユーラシア極東部">ティクシ</option>
  <option value="ペ,7324,2428" class="ユーラシア極東部">ペトロパブロフスク</option>  
</select>
使い方<br/>
表示でプロットします<br/>
z,xxx,yyy<br/>
zとプロット<br/>
xxx,yyy<br/>
頭に勝手に行番号が入ってプロット<br/>
aqua,black,blue,fuchsia,gray,green,lime,maroon,navy,olive,orange,purple,red,silver,teal,white,yellow<br/>
プロットの色を変えます。<br/>
